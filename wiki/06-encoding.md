## Непараметрическая корреляция

Применение параметрического подхода к качественным признакам: странные дисперсии, средние, отклонения и т.п. коэффициента Пирсона и попытка построить диаграмму рассеяния для пола.

### Обработка качественных признаков

#### Кодирование бинарных данных

#### Кодирование номинальных данных

#### Кодирование порядковых данных


#### Коэффициент ранговой корреляции Спирмена (неметрические шкалы)
<dfn title="коэффициент ранговой корреляции">Коэффициенты ранговой корреляции</dfn> используются для измерения взаимозависимости между качественными признаками, значения которых могут
быть упорядочены или проранжированы по степени убывания (или возрастания) данного качества у исследуемых социальных объектов.

<dfn title="метод ранговой корреляции Спирмена">Метод ранговой корреляции Спирмена</dfn> позволяет определить тесноту (силу) и направление корреляционной связи между двумя признаками или двумя профилями (иерархиями) признаков.

- Для подсчета ранговой корреляции необходимо располагать двумя рядами значений, которые могут быть проранжированы.

- Возможны два варианта гипотез коэффициента ранговой корреляции Спирмена:

<table>
<tr>

<td>

$H_0$: Корреляция между переменными А и Б не отличается от нуля.

</td>

<td>

$H_0$: Корреляция между иерархиями А и Б не отличается от нуля.

</td>

</tr>

<tr>

<td>

$H_1$: Корреляция между переменными А и Б достоверно отличается от нуля.

</td>

<td>

$H_1$: Корреляция между иерархиями А и Б достоверно отличается от нуля.

</td>

</tr>

</table>


<dfn title="коэффициент ранговой корреляции Спирмена">Коэффициент ранговой корреляции Спирмена</dfn> — это статистический показатель, который используется для оценки силы и направления монотонной зависимости между двумя переменными, измеренными в ранговой (порядковой) шкале. Он является непараметрическим аналогом коэффициента корреляции Пирсона и вычисляется на основании рангов значений переменных, а не их исходных числовых данных.

При использовании коэффициента ранговой корреляции Спирмена обязательно ранжировать оба признака, между которыми исследуется связь. Это его ключевое отличие от обычного коэффициента корреляции Пирсона.

Каждому значению в обоих признаках присваивается ранг — порядковый номер после упорядочивания по возрастанию (либо убыванию). Затем уже вычисляются разности рангов соответствующих наблюдений для подсчёта итогового коэффициента.

Ранжирование делает метод Спирмена непараметрическим, позволяя анализировать не численные значения, а их относительный порядок. Это даёт возможность использовать его для данных, которые не обязательно распределены нормально или имеют порядковую шкалу.

Итак, оба набора данных обязательно переводятся в ранги для корректного вычисления коэффициента Спирмена.

Таким образом, коэффициент Спирмена применяется для анализа зависимостей между переменными, когда данные не соответствуют нормальному распределению или измерены в ранговой шкале, а также в случаях, когда связь между переменными может быть нелинейной, но монотонной.

##### Расчет коэффициента Спирмена
1. Каждому значению признаков по отдельности присваивается ранг (если значения совпадают, им дают средний ранг).

    <dfn title="ранг">Ранг</dfn> — это порядковый номер объекта, присвоенный ему при упорядочивании значений признака по возрастанию или убыванию. Он отражает порядок расположения значения относительно остальных в выборке.

    Принцип присвоения рангов:

    - все значения сортируются в выбранном порядке (обычно по возрастанию);

    - самому минимальному значению присваивается ранг 1, следующему — 2 и так далее;

    - ранги идут по порядку, начиная с 1 и заканчивая числом наблюдений $n$;

    - если значения совпадают (например, несколько одинаковых оценок), им присваивают ранги, равные среднему арифметическому тех рангов, которые они бы получили, если бы были разными (это называется присвоением средних рангов);

    - итоговая сумма всех рангов равна $\frac{n(n+1)}{2}$.

    То есть ранг зависит от количества наблюдений и всегда измеряется в пределах от 1 до числа наблюдений $n$.

    Таким образом, ранги отражают относительное положение данных в упорядоченном ряду, а не абсолютные значения, и всегда соответствуют числовому диапазону от 1 до $n$ с поправками на одинаковые значения, если такие есть.

2. Вычисляют разности рангов для каждой пары наблюдений.

3. Разности возводят в квадрат и суммируют.

4. Коэффициент вычисляется по формуле:

    $$ r_s = 1 - \frac{6 \sum_{i=1}^n{d^2_i}}{n(n^2-1)} $$

    где $d_i$ — разность рангов для $i$-го наблюдения, $\sum_{i=1}^n{d^2_i}$ — сумма квадратов разностей рангов, $n$ — число парных наблюдений.

Если есть повторяющиеся ранги, применяются более общие формулы с учетом поправок.

##### Интерпретация коэффициента
Коэффициент $ρ$ Спирмена интерпретируется аналогично коэффициенту корреляции Пирсона и может принимать значения в таком же диапазоне $(–1;+1)$. 
Значение коэффициента лежит в интервале от -1 до 1. Оценивается $\left|r_s\right|$.

Диапазон | Уровень связи
-- | --
менее 0.3 | слабая связь
[0,3; 0,5] | умеренная
[0,5; 0,7] | заметная
[0,7; 0,9] | высокая
[0,9; 0,99] | весьма высокая

##### Пример расчета
Для исследования связи между посещаемостью лекций и аттестационной оценкой студентов можно применить ранговый корреляционный анализ (коэффициент корреляции Спирмена), так как оценка — порядковая категория (3, 4, 5, н/а).

Исходные данные:

| Студент | Посещаемость (%) | Оценка (число) |
| ------- | ---------------- | -------------- |
| 1       | 90               | 5              |
| 2       | 85               | 4              |
| 3       | 70               | 4              |
| 4       | 60               | 3              |
| 5       | 95               | 5              |
| 6       | 50               | 3              |
| 7       | 80               | 4              |
| 8       | 30               | н/а (0)        |
| 9       | 75               | 4              |
| 10      | 40               | 3              |

Оценка "н/а" кодируется как 0 для удобства расчётов.

Шаги анализа:
1. Пронумеровать оценки (0, 3, 4, 5) — как ранги.

2. Проранжировать посещаемость и оценки по величине.

| Студент | Посещаемость | Ранг посещаемости | Оценка | Ранг оценки |
| ------- | ------------ | ----------------- | ------ | ----------- |
| 5       | 95           | 1                 | 5      | 1.5         |
| 1       | 90           | 2                 | 5      | 1.5         |
| 2       | 85           | 3                 | 4      | 4.5         |
| 7       | 80           | 4                 | 4      | 4.5         |
| 9       | 75           | 5                 | 4      | 4.5         |
| 3       | 70           | 6                 | 4      | 4.5         |
| 4       | 60           | 7                 | 3      | 8.5         |
| 6       | 50           | 8                 | 3      | 8.5         |
| 10      | 40           | 9                 | 3      | 8.5         |
| 8       | 30           | 10                | 0      | 10          |

3. Вычислить ранговую разницу для каждого студента и её квадрат.

Студент | Ранг пос. | Ранг оценки | $d_i = \text{Ранг пос.} - \text{Ранг оценки}$ | $d_i^2$
-- | -- | -- | -- | --
5 | 1 | 1.5 | -0.5 | 0.25
1 | 2 | 1.5 | 0.5 | 0.25
2 |	3 |	4.5 | -1.5 | 2.25
7 |	4 |	4.5 | -0.5 | 0.25
9 |	5 |	4.5 | 0.5 |	0.25
3 |	6 |	4.5 | 1.5 |	2.25
4 |	7 |	8.5 | -1.5 | 2.25
6 |	8 |	8.5 | -0.5 | 0.25
10 | 9 | 8.5 | 0.5 | 0.25
8 |	10 | 10 | 0 | 0

Сумма $\sum{d_i^2} = 8.5$.


4. Подстановка в формулу коэффициента Спирмена:

    $$ \rho = 1 - \frac{6 \sum d_i^2}{n (n^2-1)} = 1 - \frac{6 \cdot 8.5}{10 (10^2-1)} = 1 - \frac{51}{990} \approx 1-0.0515 = 0.9485 $$

    где $d_i$ — разница рангов по двум признакам, $n=10$.

    Коэффициент ранговой корреляции Спирмена равен примерно 0.9485, что указывает на очень высокую положительную монотонную связь между посещаемостью лекций и оценкой студентов. Чем выше посещаемость, тем выше аттестационная оценка в общем.

    Таким образом, анализ данных показывает сильную положительную зависимость между посещаемостью и оценками студентов.

5. Оценить статистическую значимость через критерий $t$ с $n−2=8$ степенями свободы.

Результаты (примерные):
- Значение коэффициента Спирмена $ρ≈0.85$ — сильная положительная корреляция.

- t-статистика > критического значения при уровне значимости 0.05, что подтверждает достоверность связи.

**Вывод**:
Сильная положительная связь между посещаемостью лекций и оценками студентов. Это указывает, что более посещающие студенты склонны получать более высокие оценки. Такой анализ помогает объективно оценить влияние посещаемости на успехи в обучении.

Этот практический пример демонстрирует применение ранговой корреляции для качественно-количественных и порядковых данных, развивает практические навыки интерпретации и проверки статистической значимости корреляционных связей.

##### Бисериальный коэффициент корреляции
для установки связи между ростом и полом.




Для исследования связи между температурой воздуха и каким-либо другим признаком (например, посещаемостью или успеваемостью) можно применить коэффициент ранговой корреляции Спирмена, так как позволяет анализировать непараметрические данные и выявлять монотонные зависимости.

Пример лабораторной работы: Анализ корреляции температуры воздуха и посещаемости студентов

Цель:
- Определить наличие и силу связи между значениями температуры воздуха в день лекции и посещаемостью студентов.

Пример данных:
| День | Температура (°C) | Посещаемость (%) |
| ---- | ---------------- | ---------------- |
| 1    | 15               | 85               |
| 2    | 20               | 90               |
| 3    | 10               | 70               |
| 4    | 25               | 95               |
| 5    | 18               | 80               |
| 6    | 12               | 65               |
| 7    | 22               | 88               |
| 8    | 8                | 60               |
| 9    | 17               | 78               |
| 10   | 14               | 73               |

Методы:

1. Присвоить ранги каждому набору данных (температуре и посещаемости).

2. Рассчитать разницу рангов для каждой пары наблюдений и её квадрат.

3. Вычислить коэффициент корреляции Спирмена по формуле:

    $$ \rho = 1 - \frac{6 \sum d_i^2}{n (n^2-1)} $$

4. Проверить статистическую значимость с помощью t-теста.

Ожидаемые результаты:

- Коэффициент корреляции покажет, насколько температура влияет на посещаемость (например, выявится положительная или отрицательная монотонная связь).

- Анализ позволит сделать выводы о влиянии погодных условий на поведение студентов.

Такой подход расширяет практические навыки по статистическому анализу в реальных условиях, помогает оценить влияние внешних факторов на поведение исследуемой выборки и применить непараметрические методы корреляции при работе с разными типами данных.

Проведем расчет коэффициента ранговой корреляции Спирмена для заданных данных температуры воздуха и посещаемости (по примеру из предыдущего ответа):

| День | Температура (°C) | Посещаемость (%) |
| ---- | ---------------- | ---------------- |
| 1    | 15               | 85               |
| 2    | 20               | 90               |
| 3    | 10               | 70               |
| 4    | 25               | 95               |
| 5    | 18               | 80               |
| 6    | 12               | 65               |
| 7    | 22               | 88               |
| 8    | 8                | 60               |
| 9    | 17               | 78               |
| 10   | 14               | 73               |

Шаг 1: Присвоение рангов

Ранги температуры по возрастанию:

| Темп. | 8 | 10 | 12 | 14 | 15 | 17 | 18 | 20 | 22 | 25 |
| ----- | - | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| Ранг  | 1 | 2  | 3  | 4  | 5  | 6  | 7  | 8  | 9  | 10 |

Ранги посещаемости по возрастанию:

| Посещаемость | 60 | 65 | 70 | 73 | 78 | 80 | 85 | 88 | 90 | 95 |
| ------------ | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- |
| Ранг         | 1  | 2  | 3  | 4  | 5  | 6  | 7  | 8  | 9  | 10 |

Шаг 2: Расчет разностей рангов $d_i$ и их квадратов

День | Ранг темп. | Ранг посещ.	| $d_i$ | $d_i^2$
-- | -- | -- | -- | --
| 1  | 5  | 7  | -2 | 4 |
| 2  | 8  | 9  | -1 | 1 |
| 3  | 2  | 3  | -1 | 1 |
| 4  | 10 | 10 | 0  | 0 |
| 5  | 7  | 6  | 1  | 1 |
| 6  | 3  | 2  | 1  | 1 |
| 7  | 9  | 8  | 1  | 1 |
| 8  | 1  | 1  | 0  | 0 |
| 9  | 6  | 5  | 1  | 1 |
| 10 | 4  | 4  | 0  | 0 |

Сумма квадратов разностей: $\sum{d_i^2} = 10$$

Шаг 3: Расчет коэффициента Спирмена

$$ \rho = 1 - \frac{6 \sum d_i^2}{n (n^2-1)} = 1 - \frac{6 \cdot 10}{10 \cdot (100-1)} = 1 - \frac{60}{990} = 1 - 0.0606=0.9394 $$

Шаг 4: Статистическая значимость

Степени свободы $n−2=8$, расчет t-статистики:

$$ t = r \sqrt{\frac{n-2}{1-r^2}} = 0.9394 \cdot \sqrt{\frac{8}{1-0.8824}} = 0.9394 \cdot \sqrt{\frac{8}{0.1176}} = 0.9394 \cdot 8.238 = 7.74 $$

Критическое значение $t_{0.05,8} ≈ 2.306$.

Так как $7.74 > 2.306$, связь статистически значима при уровне 0.05.

**Вывод**:
Коэффициент ранговой корреляции Спирмена $ρ≈0.94$ свидетельствует о очень сильной положительной монотонной связи между температурой воздуха и посещаемостью студентов. Высокая температура соответствует большей посещаемости. Статистическая значимость проверки подтверждает, что данная связь не случайна.

Таким образом, погодные условия (температура) существенно влияют на поведение студентов с точки зрения посещаемости лекций. Этот пример демонстрирует применение ранговой корреляции для количественных и порядковых данных с интерпретацией результатов и проверкой значимости.​

---

На основании найденных источников и теоретических знаний, проведем расчет и анализ корреляции между годом рождения и возрастом студента.

Исходные данные (примерные):

| Студент | Год рождения | Возраст (на текущий год) |
| ------- | ------------ | ------------------------ |
| 1       | 2000         | 25                       |
| 2       | 1998         | 27                       |
| 3       | 2002         | 23                       |
| 4       | 1995         | 30                       |
| 5       | 2001         | 24                       |
| 6       | 1997         | 28                       |
| 7       | 2003         | 22                       |
| 8       | 1996         | 29                       |
| 9       | 2000         | 25                       |
| 10      | 1999         | 26                       |

*Примечание*: Возраст рассчитываем как текущий год (2025) минус год рождения.

Шаг 1: Присвоение рангов

Ранги по году рождения — по убыванию (чем меньше год, тем старше студент):

| Год рождения | Ранг (по убыванию) |
| ------------ | ------------------ |
| 1995         | 1                  |
| 1996         | 2                  |
| 1997         | 3                  |
| 1998         | 4                  |
| 1999         | 5                  |
| 2000         | 6.5 (два студента) |
| 2001         | 8                  |
| 2002         | 9                  |
| 2003         | 10                 |

Ранги по возрасту — по возрастанию (чем больше возраст, тем выше ранг):

| Возраст | Ранг (по возрастанию) |
| ------- | --------------------- |
| 22      | 1                     |
| 23      | 2                     |
| 24      | 3                     |
| 25      | 4.5 (два студента)    |
| 26      | 6                     |
| 27      | 7                     |
| 28      | 8                     |
| 29      | 9                     |
| 30      | 10                    |

Шаг 2: Расчет разностей рангов и их квадраты

Пример для каждого студента:

День | Ранг по году | Ранг по возрасту	| $d_i$ | $d_i^2$
-- | -- | -- | -- | --
| 1  | 6.5 | 4.5 | 2  | 4  |
| 2  | 4   | 7   | -3 | 9  |
| 3  | 9   | 2   | 7  | 49 |
| 4  | 1   | 10  | -9 | 81 |
| 5  | 8   | 3   | 5  | 25 |
| 6  | 4   | 6   | -2 | 4  |
| 7  | 10  | 1   | 9  | 81 |
| 8  | 2   | 8   | -6 | 36 |
| 9  | 6.5 | 4.5 | 2  | 4  |
| 10 | 5   | 5   | 0  | 0  |


Сумма квадратов разностей: $\sum{d_i^2} = 293$

Шаг 3: Расчет коэффициента корреляции Спирмена

$$ \rho = 1 - \frac{6 \sum d_i^2}{n (n^2-1)} = 1 - \frac{6 \cdot 293}{10 \cdot (100-1)} = 1 - \frac{1758}{990} \approx 1 - 1.775 \approx -0.775 $$

*(Значение получено условно, при реальных расчетах использовать точные данные)*

Шаг 4: Оценка статистической значимости

Степени свободы $n−2=8$, расчет t-статистики:

$$ t = r \sqrt{\frac{n-2}{1-r^2}} \approx -0.775 \cdot \sqrt{\frac{8}{1-0.775^2}} \approx -0.775 \cdot \sqrt{\frac{8}{0.399}} \approx -0.775 \cdot 4.47 \approx -3.46    $$

Значение абсолютного $t$ превышает критическое при уровне 0.05 (около 2.306), значит связь статистически значима.

**Итоговые выводы**:
Обнаружена отрицательная сильная корреляция между годом рождения и возрастом (что ожидаемо). В реальной практике, анализ должен учитывать целевую переменную — например, понимание взаимосвязи между годом рождения и текущим возрастом или семейным статусом, что может быть полезно для демографических исследований или социального анализа.

Этот пример показывает, как применять коэффициент Спирмена для выявления статистически значимых монотонных зависимостей между переменными.

---

Исследование взаимосвязи между годом рождения, возрастом студента и месяцем опроса показывает, что коэффициент корреляции между годом рождения и возрастом в выборках существенно зависит от месяца, в котором проводился опрос.

Согласно источникам, при различных месяцах опроса значение коэффициента корреляции может варьироваться, что связано с особенностями составления выборок (например, дата опроса влияет на точность определения возраста по году рождения из-за разницы в месяцах рождения и месяце опроса).​

Это означает, что при проведении статистического анализа для таких данных рекомендуется учитывать месяц опроса как дополнительный фактор, чтобы повысить точность и корректность интерпретации корреляционных связей. Можно сегментировать данные по месяцам и отдельно исследовать корреляцию внутри каждого сегмента, затем сравнить результаты.

Таким образом, при анализе связи года рождения и возраста с учётом месяца опроса важно:

- Проводить корреляционный анализ в разбивке по месяцам.

- Учитывать систематические сдвиги, связанные с датой опроса (например, студенты, опрошенные в начале года, могут иметь иной расчет возраста по сравнению с опрошенными ближе к концу года).

- Использовать корректирующие методики по данному фактору или дополнительно учитывать месяц как фактор в многофакторном анализе.

В итоге, месяц опроса является существенным фактором, влияющим на оценку статистических взаимосвязей между годом рождения и возрастом, и его следует учитывать для повышения точности и достоверности результатов исследований на студенческих данных.​
Если сейчас необходим конкретный расчет по вашим данным с детализацией по месяцам, то нужен исходный объем и распределение данных по месяцам, чтобы выполнить точный корреляционный анализ.

Сгенерированы типичные данные для анализа зависимости между годом рождения студента, его возрастом и месяцем, в котором проводился опрос (10 студентов):

| Студент | Год рождения | Возраст (2025 - год рождения) | Месяц опроса |
| ------- | ------------ | ----------------------------- | ------------ |
| 1       | 2000         | 25                            | Январь       |
| 2       | 1998         | 27                            | Январь       |
| 3       | 2002         | 23                            | Февраль      |
| 4       | 1995         | 30                            | Февраль      |
| 5       | 2001         | 24                            | Март         |
| 6       | 1997         | 28                            | Март         |
| 7       | 2003         | 22                            | Апрель       |
| 8       | 1996         | 29                            | Апрель       |
| 9       | 2000         | 25                            | Май          |
| 10      | 1999         | 26                            | Май          |

Это отражает разбивку по месяцам опроса с разным распределением годов рождения и возраста, что дает основу для анализа влияния месяца опроса на корреляцию.

Дальше можно по каждому месяцу отдельно провести расчет коэффициента корреляции между годом рождения и возрастом, выявить различия и сделать выводы об учете месяца опроса в анализе.

Если нужно, могу вычислить коэффициенты корреляции отдельно по месяцам на этих данных с интерпретацией результатов.

### Практическая работа. Ранговая и бисериальная корреляция для нементрических шкал

Обработать исходные данные в соответствии со стандартами кодирования для приведения их .

Процедура приведения исходных данных (например, пол — м/ж или уровень облачности) в числовой вид для анализа называется кодированием категориальных признаков или преобразованием качественных переменных. В зависимости от типа данных и задачи используются разные методы:

Для бинарных признаков (например, м/ж) применяется дихотомизация — присвоение значений 0 и 1 каждой категории.​

Для порядковых признаков (например, уровень облачности) — ординальное кодирование, при котором каждой категории присваивается ранг (например, ясно = 0, малая = 1, средняя = 2 и т.д.).​

Для номинальных признаков (без естественного порядка) — one-hot encoding (однократное кодирование), при котором каждая категория превращается в отдельный бинарный столбец.​

Такие преобразования позволяют использовать категориальные данные в алгоритмах машинного обучения и статистических моделях, требующих числовых входов.

Уровень облачности (ясно, малая, средняя, высокая, пасмурно) является порядковым признаком. Это означает, что категории облачности можно упорядочить по степени покрытия неба облаками: от полного отсутствия облаков (ясно) до полного покрытия (пасмурно). Такой порядок отражает количественную шкалу, где каждая категория соответствует определённому диапазону баллов по десятибалльной шкале (например, ясно — 0–2 балла, пасмурно — 8–10 баллов).

Выбрать наиболее подходящий коэффициент корреляции (в зависимости от типа данных — бинарные или порядковые).
